{% extends 'base.html' %}
{% load static %}

{% block title %}Polls{% endblock title %}
{% block header %}Poll Options{% endblock header %}

{% block loadjs %}
    {{ block.super }}
    <script src="{% static 'ajax_polls/js/jquery-3.3.1.min.js' %}" type="text/javascript"></script>
{% endblock loadjs %}

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'ajax_polls/css/style.css' %}" />
{% endblock styles %}

{% block content %}
  <div>
    {% if latest_question_list %}
      <ul class="list-group">
        {% for question in latest_question_list %}
          <li class="list-group-item">
            <a name="{{ question.id }}" class="ajax-polls-item">{{ question.question_text }}</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="empty">No polls are available.</p>
    {% endif %}
  </div>
{% endblock content %}

{% block js %}
<script type="text/javascript">
  var pollsItemList = document.getElementsByClassName("ajax-polls-item");
  var whole_url = "{% url 'ajax_polls:ajax_polls' %}";
  listenerAdd = function (element) {
    element.addEventListener('click', function() {
      new $.ajax({
        url: whole_url,
        method: 'GET',
        data: {'question_pk': element['name'], },
        success: function(response) {
          console.log(response);
          addChild(element, response);
        }
      });      
    });
  }
  addChild = function (element, response) {
    var newList = document.createElement("UL");
    element.appendChild(newList);
    for (var key in response) {
      if (response.hasOwnProperty(key)) {
        var newListItem = document.createElement("LI");
        newList.appendChild(newListItem);
        var newListTag = document.createElement("a");
        newListTag.setAttribute('choice_pk', key);
        newListTag.setAttribute('class', 'some-odd-class');
        var newListText = document.createTextNode(response[key]['choice_text']);
        newListTag.appendChild(newListText);
        newListItem.appendChild(newListTag);
      }
  }
  }
  for (i = 0; i < pollsItemList.length; i++) {
    listenerAdd(pollsItemList[i]);
    console.log(pollsItemList[i]);
  }
</script>
{% endblock js %}